// Do not edit directly!
// This file was generated by cq-maven-plugin:update-doc-page
[id="quarkus-cxf-rt-features-metrics"]
= Metrics Feature
:linkattrs:
:cq-artifact-id: quarkus-cxf-rt-features-metrics
:cq-group-id: io.quarkiverse.cxf
:cq-status: Stable
:cq-deprecated: false
:cq-since: 0.14.0

ifeval::[{doc-show-badges} == true]
Stable â€¢ Since 0.14.0
endif::[]

Collect metrics using https://micrometer.io/[Micrometer].

IMPORTANT: https://cxf.apache.org/docs/dropwizard-metrics.html[Dropwizard Metrics] are not supported.
           They do not work in native mode and the are no tests for JVM mode.


[id="quarkus-cxf-rt-features-metrics-maven-coordinates"]
== Maven coordinates

Create https://{link-quarkus-code-generator}/?extension-search=quarkus-cxf-rt-features-metrics[a new project using `quarkus-cxf-rt-features-metrics` on {link-quarkus-code-generator}, window="_blank"]
or add these coordinates to your existing project:

[source,xml]
----
<dependency>
    <groupId>io.quarkiverse.cxf</groupId>
    <artifactId>quarkus-cxf-rt-features-metrics</artifactId>
</dependency>
----
ifeval::[{doc-show-user-guide-link} == true]
[TIP]
====
Check the xref:user-guide/index.adoc[User guide] and especially its
xref:user-guide/create-project.adoc#dependency-management[Dependency management] section
for more information about writing applications with {quarkus-cxf-project-name}.
====
endif::[]

[id="quarkus-cxf-rt-features-metrics-usage"]
== Usage

The integration of CXF into the https://quarkus.io/guides/micrometer[Quarkus Micrometer] ecosystem is implemented using
`io.quarkiverse.cxf.metrics.QuarkusCxfMetricsFeature`.
As long as your application depends on `quarkus-cxf-rt-features-metrics`,
an instance of `QuarkusCxfMetricsFeature` is created internally
and enabled by default for all clients and service endpoints created by {quarkus-cxf-project-name}.
You can disable it via `quarkus.cxf.metrics.enabled-for`, `quarkus.cxf.client."clients".metrics.enabled`
and `quarkus.cxf.endpoint."endpoints".metrics.enabled` properties documented below.

[id="extensions-quarkus-cxf-rt-features-metrics-usage-runnable-example"]
=== Runnable example

There is an https://github.com/quarkiverse/quarkus-cxf/tree/main/integration-tests/metrics[integration test]
covering Micrometer Metrics in the {quarkus-cxf-project-name} source tree.

Unsurprisingly, it depends on `quarkus-cxf-rt-features-metrics`

.pom.xml
[source,xml]
----
<dependency>
    <groupId>io.quarkiverse.cxf</groupId>
    <artifactId>quarkus-cxf-rt-features-metrics</artifactId>
</dependency>
----

It is using `quarkus-micrometer-registry-prometheus` extension to export the metrics in JSON format and for Prometheus:

.pom.xml
[source,xml]
----
<dependency>
    <groupId>io.quarkus</groupId>
    <artifactId>quarkus-micrometer-registry-prometheus</artifactId>
</dependency>
----

The following configuration is needed to be able to inspect the collected metrics over a REST endpoint:

.application.properties
[source,properties]
----
include::example$metrics/application.properties[tag=micrometer-export]
----

Having all the above in place, you can start the application in Dev mode:

[source,shell]
----
$ mvn quarkus:dev
----

Now send a request to the `HelloService`:

[source,shell]
----
$ curl \
  -d '<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><ns2:helloResponse xmlns:ns2="http://it.server.metrics.cxf.quarkiverse.io/"><return>Hello Joe!</return></ns2:helloResponse></soap:Body></soap:Envelope>' \
  -H 'Content-Type: text/xml' \
  -X POST \
  http://localhost:8080/metrics/client/hello
----

After that, you should see some metrics under `cxf.server.requests` in the output of the endpoint you configured above:

[source,shell]
----
$ curl http://localhost:8080/q/metrics/json
metrics: {
    ...
    "cxf.server.requests": {
        "count;exception=None;faultCode=None;method=POST;operation=hello;outcome=SUCCESS;status=200;uri=/soap/hello": 2,
        "elapsedTime;exception=None;faultCode=None;method=POST;operation=hello;outcome=SUCCESS;status=200;uri=/soap/hello": 64.0
    },
    ...
}
----


[id="quarkus-cxf-rt-features-metrics-configuration"]
== Configuration

[.configuration-legend]
icon:lock[title=Fixed at build time] Configuration property fixed at build time. All other configuration properties are overridable at runtime.

[.configuration-reference.searchable, cols="80,.^10,.^10", stripes=odd]
|===
| Configuration property | Type | Default


.<| [[quarkus-cxf_quarkus-cxf-metrics-enabled-for]]`link:#quarkus-cxf_quarkus-cxf-metrics-enabled-for[quarkus.cxf.metrics.enabled-for]`
.<| `clients`, `services`, `both`, `none`
.<| `both`

3+a|Specifies whether the metrics collection will be enabled for clients, services, both or none. This global setting can
be overridden per client or service endpoint using the `quarkus.cxf.client."clients".metrics.enabled` or
`quarkus.cxf.endpoint."endpoints".metrics.enabled` option respectively.

*Environment variable*: `+++QUARKUS_CXF_METRICS_ENABLED_FOR+++` +
*Since Quarkus CXF*: 2.7.0

.<| [[quarkus-cxf_quarkus-cxf-client-clients-metrics-enabled]]`link:#quarkus-cxf_quarkus-cxf-client-clients-metrics-enabled[quarkus.cxf.client."clients".metrics.enabled]`
.<| `boolean`
.<| `true`

3+a|If `true` and if `quarkus.cxf.metrics.enabled-for` is set to `both` or `clients` then the `MetricsFeature` will
be added to this client; otherwise the feature will not be added to this client.

*Environment variable*: `+++QUARKUS_CXF_CLIENT__CLIENTS__METRICS_ENABLED+++` +
*Since Quarkus CXF*: 2.7.0

.<| [[quarkus-cxf_quarkus-cxf-endpoint-endpoints-metrics-enabled]]`link:#quarkus-cxf_quarkus-cxf-endpoint-endpoints-metrics-enabled[quarkus.cxf.endpoint."endpoints".metrics.enabled]`
.<| `boolean`
.<| `true`

3+a|If `true` and if `quarkus.cxf.metrics.enabled-for` is set to `both` or `services` then the `MetricsFeature` will
be added to this service endpoint; otherwise the feature will not be added to this service endpoint.

*Environment variable*: `+++QUARKUS_CXF_ENDPOINT__ENDPOINTS__METRICS_ENABLED+++` +
*Since Quarkus CXF*: 2.7.0
|===

